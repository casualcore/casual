# configuration domain (general) 

[//]: # (Attention! this is a generated markdown from casual-configuration-documentation - do not edit this file!)

This is the runtime configuration for a casual domain.

The sections can be splitted in arbitrary ways, and aggregated to one configuration model `casual` uses.
Same sections can be defined in different files, hence, give more or less unlimited configuration setup.

Most of the _sections_ has a property `note` for the user to provide descriptions of the documentation. 
The examples further down uses this to make it easier to understand the examples by them self. But can of
course be used as a mean to help document actual production configuration.  


## structures

General "structures" that other parts of the configuration refers to.


### domain::Environment

#### Variable

property       | description
---------------|----------------------------------------------------
key            | environment variable name
value          | the value to associate with the environment variable

property       | description
---------------|----------------------------------------------------
variables      | `0..*` `domain::environment::Variable`, described above.


### service::execution::Timeout

property       | description
---------------|----------------------------------------------------
duration       | timeout of service, from the _caller_ perspective (example: `30ms`, `1h`, `3min`, `40s`. if no SI unit `s` is used)
contract       | defines action to take if timeout is passed (linger = just wait, kill = send kill signal, terminate = send terminate signal)


## domain.global

Defines _domain global_ configuration.

### domain.global.service

_domain global_ settings for services. This will effect services that are not otherwise configured explicitly,

property       | description
---------------|----------------------------------------------------
execution      | `service::execution::Timeout`, described above.

## domain.default

'default' configuration. Will be used as fallback within a configuration. Will not aggregate 'between' configurations.
Only used to help user minimize common configuration.

### domain.default.server

property       | description
---------------|----------------------------------------------------
instances      | number of instances to start of the server.
memberships    | `0..*` default group memberships.
environment    | `domain::Environment` described above.
restart        | if the server should be restarted, if exit.

### domain.default.executable

property       | description
---------------|----------------------------------------------------
instances      | number of instances to start of the server.
memberships    | `0..*` default group memberships.
environment    | `domain::Environment` described above.
restart        | if the executable should be restarted, if exit.

### domain.default.service

property         | description
-----------------|----------------------------------------------------
execution        | `service::execution::Timeout`, described above.
visibility       | visibility (from other domains). Possible values: [ 'discoverable', 'undiscoverable'] 

## domain.groups

Defines the groups in the configuration. Groups are used to associate `resources` to servers/executables
and to define the dependency order.

property       | description
---------------|----------------------------------------------------
name           | the name (unique key) of the group.
dependencies   | defines which other groups this group has dependency to.
resources      | defines which resources (name) this group associate with (transient to the members of the group)


## domain.servers

Defines all servers of the configuration (and domain) 

property       | description
---------------|----------------------------------------------------
path           | the path to the binary, can be relative to `CASUAL_DOMAIN_HOME`, or implicit via `PATH`.
alias          | the logical (unique) name of the server. If not provided basename of `path` will be used
arguments      | arguments to `tpsvrinit` during startup.
instances      | number of instances to start of the server.
memberships    | which groups are the server member of (dictates order, and possible resource association)
restrictions   | regex pattern, if provided only the services that matches at least one of the patterns are actually advertised.
resources      | explicit resource associations (transaction.resources.name)
restart        | if the server should be restarted, if exit.


## domain.executables

Defines all _ordinary_ executables of the configuration. Could be any executable with a `main` function

property       | description
---------------|----------------------------------------------------
path           | the path to the binary, can be relative to `CASUAL_DOMAIN_HOME`, or implicit via `PATH`.
alias          | the logical (unique) name of the executable. If not provided basename of `path` will be used
arguments      | arguments to `main` during startup.
instances      | number of instances to start of the server.
memberships    | which groups are the server member of (dictates order)
restart        | if the executable should be restarted, if exit.


## domain.services

Defines service related configuration. 

Note that this configuration is tied to the service, regardless who has advertised the service.

property         | description
-----------------|----------------------------------------------------
name             | name of the service
routes           | defines what logical names are actually exposed. For _aliases_, it's important to include the original name.
execution        | `service::execution::Timeout`, described above.
visibility       | visibility (from other domains). Possible values: [ 'discoverable', 'undiscoverable'] 


## examples 

Below follows examples in human readable formats that `casual` can handle

### yaml
```` yaml
---
domain:
  name: "domain-name"
  global:
    note: "'domain global' config. Aggregates right to left"
    service:
      note: "Will be used for services that are not explicitly configured."
      execution:
        timeout:
          duration: "2h"
          contract: "linger"
  default:
    note: "'default', fallback, configuration. Will only affect 'local' configuration and will not aggregate 'between' configurations"
    server:
      instances: 1
      restart: true
      memberships:
        - "customer-group"
      environment:
        variables:
          - key: "SOME_VARIABLE"
            value: "foo"
    executable:
      instances: 1
      restart: false
    service:
      execution:
        timeout:
          duration: "20s"
      visibility: "discoverable"
  environment:
    variables:
      - key: "SOME_VARIABLE"
        value: "42"
      - key: "SOME_OTHER_VARIABLE"
        value: "some value"
  groups:
    - name: "common-group"
      note: "group that logically groups 'common' stuff"
    - name: "customer-group"
      note: "group that logically groups 'customer' stuff"
      resources:
        - "customer-db"
      dependencies:
        - "common-group"
    - name: "sales-group"
      note: "group that logically groups 'customer' stuff"
      resources:
        - "sales-db"
        - "event-queue"
      dependencies:
        - "customer-group"
  servers:
    - path: "/some/path/customer-server-1"
      memberships:
        - "customer-group"
    - path: "/some/path/customer-server-2"
      memberships:
        - "customer-group"
    - path: "/some/path/sales-server"
      alias: "sales-pre"
      note: "the only services that will be advertised are the ones who matches regex \"preSales.*\""
      instances: 10
      memberships:
        - "sales-group"
      restrictions:
        - "preSales.*"
    - path: "/some/path/sales-server"
      alias: "sales-post"
      note: "he only services that will be advertised are the ones who matches regex \"postSales.*\""
      memberships:
        - "sales-group"
      restrictions:
        - "postSales.*"
    - path: "/some/path/sales-broker"
      memberships:
        - "sales-group"
      environment:
        variables:
          - key: "SALES_BROKER_VARIABLE"
            value: "556"
      resources:
        - "event-queue"
  executables:
    - path: "/some/path/mq-server"
      arguments:
        - "--configuration"
        - "/path/to/configuration"
      memberships:
        - "common-group"
  services:
    - name: "a"
      execution:
        timeout:
          duration: "64ms"
          contract: "terminate"
      routes:
        - "b"
        - "c"
      visibility: "undiscoverable"
...

````
### json
```` json
{
    "domain": {
        "name": "domain-name",
        "global": {
            "note": "'domain global' config. Aggregates right to left",
            "service": {
                "note": "Will be used for services that are not explicitly configured.",
                "execution": {
                    "timeout": {
                        "duration": "2h",
                        "contract": "linger"
                    }
                }
            }
        },
        "default": {
            "note": "'default', fallback, configuration. Will only affect 'local' configuration and will not aggregate 'between' configurations",
            "server": {
                "instances": 1,
                "restart": true,
                "memberships": [
                    "customer-group"
                ],
                "environment": {
                    "variables": [
                        {
                            "key": "SOME_VARIABLE",
                            "value": "foo"
                        }
                    ]
                }
            },
            "executable": {
                "instances": 1,
                "restart": false
            },
            "service": {
                "execution": {
                    "timeout": {
                        "duration": "20s"
                    }
                },
                "visibility": "discoverable"
            }
        },
        "environment": {
            "variables": [
                {
                    "key": "SOME_VARIABLE",
                    "value": "42"
                },
                {
                    "key": "SOME_OTHER_VARIABLE",
                    "value": "some value"
                }
            ]
        },
        "groups": [
            {
                "name": "common-group",
                "note": "group that logically groups 'common' stuff"
            },
            {
                "name": "customer-group",
                "note": "group that logically groups 'customer' stuff",
                "resources": [
                    "customer-db"
                ],
                "dependencies": [
                    "common-group"
                ]
            },
            {
                "name": "sales-group",
                "note": "group that logically groups 'customer' stuff",
                "resources": [
                    "sales-db",
                    "event-queue"
                ],
                "dependencies": [
                    "customer-group"
                ]
            }
        ],
        "servers": [
            {
                "path": "/some/path/customer-server-1",
                "memberships": [
                    "customer-group"
                ]
            },
            {
                "path": "/some/path/customer-server-2",
                "memberships": [
                    "customer-group"
                ]
            },
            {
                "path": "/some/path/sales-server",
                "alias": "sales-pre",
                "note": "the only services that will be advertised are the ones who matches regex \"preSales.*\"",
                "instances": 10,
                "memberships": [
                    "sales-group"
                ],
                "restrictions": [
                    "preSales.*"
                ]
            },
            {
                "path": "/some/path/sales-server",
                "alias": "sales-post",
                "note": "he only services that will be advertised are the ones who matches regex \"postSales.*\"",
                "memberships": [
                    "sales-group"
                ],
                "restrictions": [
                    "postSales.*"
                ]
            },
            {
                "path": "/some/path/sales-broker",
                "memberships": [
                    "sales-group"
                ],
                "environment": {
                    "variables": [
                        {
                            "key": "SALES_BROKER_VARIABLE",
                            "value": "556"
                        }
                    ]
                },
                "resources": [
                    "event-queue"
                ]
            }
        ],
        "executables": [
            {
                "path": "/some/path/mq-server",
                "arguments": [
                    "--configuration",
                    "/path/to/configuration"
                ],
                "memberships": [
                    "common-group"
                ]
            }
        ],
        "services": [
            {
                "name": "a",
                "execution": {
                    "timeout": {
                        "duration": "64ms",
                        "contract": "terminate"
                    }
                },
                "routes": [
                    "b",
                    "c"
                ],
                "visibility": "undiscoverable"
            }
        ]
    }
}
````
### ini
```` ini

[domain]
name=domain-name

[domain.default]
note='default', fallback, configuration. Will only affect 'local' configuration and will not aggregate 'between' configurations

[domain.default.executable]
instances=1
restart=false

[domain.default.server]
instances=1
memberships=customer-group
restart=true

[domain.default.server.environment]

[domain.default.server.environment.variables]
key=SOME_VARIABLE
value=foo

[domain.default.service]
visibility=discoverable

[domain.default.service.execution]

[domain.default.service.execution.timeout]
duration=20s

[domain.environment]

[domain.environment.variables]
key=SOME_VARIABLE
value=42

[domain.environment.variables]
key=SOME_OTHER_VARIABLE
value=some value

[domain.executables]
arguments=--configuration
arguments=/path/to/configuration
memberships=common-group
path=/some/path/mq-server

[domain.global]
note='domain global' config. Aggregates right to left

[domain.global.service]
note=Will be used for services that are not explicitly configured.

[domain.global.service.execution]

[domain.global.service.execution.timeout]
contract=linger
duration=2h

[domain.groups]
name=common-group
note=group that logically groups 'common' stuff

[domain.groups]
dependencies=common-group
name=customer-group
note=group that logically groups 'customer' stuff
resources=customer-db

[domain.groups]
dependencies=customer-group
name=sales-group
note=group that logically groups 'customer' stuff
resources=sales-db
resources=event-queue

[domain.servers]
memberships=customer-group
path=/some/path/customer-server-1

[domain.servers]
memberships=customer-group
path=/some/path/customer-server-2

[domain.servers]
alias=sales-pre
instances=10
memberships=sales-group
note=the only services that will be advertised are the ones who matches regex "preSales.*"
path=/some/path/sales-server
restrictions=preSales.*

[domain.servers]
alias=sales-post
memberships=sales-group
note=he only services that will be advertised are the ones who matches regex "postSales.*"
path=/some/path/sales-server
restrictions=postSales.*

[domain.servers]
memberships=sales-group
path=/some/path/sales-broker
resources=event-queue

[domain.servers.environment]

[domain.servers.environment.variables]
key=SALES_BROKER_VARIABLE
value=556

[domain.services]
name=a
routes=b
routes=c
visibility=undiscoverable

[domain.services.execution]

[domain.services.execution.timeout]
contract=terminate
duration=64ms

````
### xml
```` xml
<?xml version="1.0"?>
<domain>
 <name>domain-name</name>
 <global>
  <note>'domain global' config. Aggregates right to left</note>
  <service>
   <note>Will be used for services that are not explicitly configured.</note>
   <execution>
    <timeout>
     <duration>2h</duration>
     <contract>linger</contract>
    </timeout>
   </execution>
  </service>
 </global>
 <default>
  <note>'default', fallback, configuration. Will only affect 'local' configuration and will not aggregate 'between' configurations</note>
  <server>
   <instances>1</instances>
   <restart>true</restart>
   <memberships>
    <element>customer-group</element>
   </memberships>
   <environment>
    <variables>
     <element>
      <key>SOME_VARIABLE</key>
      <value>foo</value>
     </element>
    </variables>
   </environment>
  </server>
  <executable>
   <instances>1</instances>
   <restart>false</restart>
  </executable>
  <service>
   <execution>
    <timeout>
     <duration>20s</duration>
    </timeout>
   </execution>
   <visibility>discoverable</visibility>
  </service>
 </default>
 <environment>
  <variables>
   <element>
    <key>SOME_VARIABLE</key>
    <value>42</value>
   </element>
   <element>
    <key>SOME_OTHER_VARIABLE</key>
    <value>some value</value>
   </element>
  </variables>
 </environment>
 <groups>
  <element>
   <name>common-group</name>
   <note>group that logically groups 'common' stuff</note>
  </element>
  <element>
   <name>customer-group</name>
   <note>group that logically groups 'customer' stuff</note>
   <resources>
    <element>customer-db</element>
   </resources>
   <dependencies>
    <element>common-group</element>
   </dependencies>
  </element>
  <element>
   <name>sales-group</name>
   <note>group that logically groups 'customer' stuff</note>
   <resources>
    <element>sales-db</element>
    <element>event-queue</element>
   </resources>
   <dependencies>
    <element>customer-group</element>
   </dependencies>
  </element>
 </groups>
 <servers>
  <element>
   <path>/some/path/customer-server-1</path>
   <memberships>
    <element>customer-group</element>
   </memberships>
  </element>
  <element>
   <path>/some/path/customer-server-2</path>
   <memberships>
    <element>customer-group</element>
   </memberships>
  </element>
  <element>
   <path>/some/path/sales-server</path>
   <alias>sales-pre</alias>
   <note>the only services that will be advertised are the ones who matches regex "preSales.*"</note>
   <instances>10</instances>
   <memberships>
    <element>sales-group</element>
   </memberships>
   <restrictions>
    <element>preSales.*</element>
   </restrictions>
  </element>
  <element>
   <path>/some/path/sales-server</path>
   <alias>sales-post</alias>
   <note>he only services that will be advertised are the ones who matches regex "postSales.*"</note>
   <memberships>
    <element>sales-group</element>
   </memberships>
   <restrictions>
    <element>postSales.*</element>
   </restrictions>
  </element>
  <element>
   <path>/some/path/sales-broker</path>
   <memberships>
    <element>sales-group</element>
   </memberships>
   <environment>
    <variables>
     <element>
      <key>SALES_BROKER_VARIABLE</key>
      <value>556</value>
     </element>
    </variables>
   </environment>
   <resources>
    <element>event-queue</element>
   </resources>
  </element>
 </servers>
 <executables>
  <element>
   <path>/some/path/mq-server</path>
   <arguments>
    <element>--configuration</element>
    <element>/path/to/configuration</element>
   </arguments>
   <memberships>
    <element>common-group</element>
   </memberships>
  </element>
 </executables>
 <services>
  <element>
   <name>a</name>
   <execution>
    <timeout>
     <duration>64ms</duration>
     <contract>terminate</contract>
    </timeout>
   </execution>
   <routes>
    <element>b</element>
    <element>c</element>
   </routes>
   <visibility>undiscoverable</visibility>
  </element>
 </services>
</domain>

````

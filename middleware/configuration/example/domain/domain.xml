<?xml version="1.0"?>
<domain>
 <name>domain.A42</name>
 <default>
  <environment>
   <files>
    <element>/some/path/to/environment/file</element>
    <element>/some/other/file</element>
   </files>
   <variables>
    <element>
     <key>SOME_VARIABLE</key>
     <value>42</value>
    </element>
    <element>
     <key>SOME_OTHER_VARIABLE</key>
     <value>some value</value>
    </element>
   </variables>
  </environment>
  <server>
   <instances>1</instances>
   <restart>true</restart>
   <memberships />
   <environment>
    <files />
    <variables />
   </environment>
  </server>
  <executable>
   <instances>1</instances>
   <restart>false</restart>
   <memberships />
   <environment>
    <files />
    <variables />
   </environment>
  </executable>
  <service>
   <timeout>90s</timeout>
  </service>
 </default>
 <transaction>
  <default>
   <resource>
    <key>db2_rm</key>
    <instances>3</instances>
   </resource>
  </default>
  <log>/some/fast/disk/domain.A42/transaction.log</log>
  <resources>
   <element>
    <name>customer-db</name>
    <instances>5</instances>
    <note>this resource is named 'customer-db' - using the default rm-key (db_rm) - overrides the default rm-instances to 5</note>
    <openinfo>db=customer,uid=db2,pwd=db2</openinfo>
   </element>
   <element>
    <name>sales-db</name>
    <note>this resource is named 'sales-db' - using the default rm-key (db_rm) - using default rm-instances</note>
    <openinfo>db=sales,uid=db2,pwd=db2</openinfo>
   </element>
   <element>
    <name>event-queue</name>
    <key>mq_rm</key>
    <note>this resource is named 'event-queue' - overrides rm-key - using default rm-instances</note>
    <openinfo>some-mq-specific-stuff</openinfo>
    <closeinfo>some-mq-specific-stuff</closeinfo>
   </element>
  </resources>
 </transaction>
 <groups>
  <element>
   <name>common-group</name>
   <note>group that logically groups 'common' stuff</note>
  </element>
  <element>
   <name>customer-group</name>
   <note>group that logically groups 'customer' stuff</note>
   <resources>
    <element>customer-db</element>
   </resources>
   <dependencies>
    <element>common-group</element>
   </dependencies>
  </element>
  <element>
   <name>sales-group</name>
   <note>group that logically groups 'customer' stuff</note>
   <resources>
    <element>sales-db</element>
    <element>event-queue</element>
   </resources>
   <dependencies>
    <element>customer-group</element>
   </dependencies>
  </element>
 </groups>
 <servers>
  <element>
   <path>customer-server-1</path>
   <memberships>
    <element>customer-group</element>
   </memberships>
  </element>
  <element>
   <path>customer-server-2</path>
   <memberships>
    <element>customer-group</element>
   </memberships>
  </element>
  <element>
   <path>sales-server</path>
   <alias>sales-pre</alias>
   <note>the only services that will be advertised are 'preSalesSaveService' and 'preSalesGetService'</note>
   <instances>10</instances>
   <memberships>
    <element>sales-group</element>
   </memberships>
   <restrictions>
    <element>preSalesSaveService</element>
    <element>preSalesGetService</element>
   </restrictions>
  </element>
  <element>
   <path>sales-server</path>
   <alias>sales-post</alias>
   <note>the only services that will be advertised are 'postSalesSaveService' and 'postSalesGetService'</note>
   <memberships>
    <element>sales-group</element>
   </memberships>
   <restrictions>
    <element>postSalesSaveService</element>
    <element>postSalesGetService</element>
   </restrictions>
  </element>
  <element>
   <path>sales-broker</path>
   <memberships>
    <element>sales-group</element>
   </memberships>
   <environment>
    <files />
    <variables>
     <element>
      <key>SALES_BROKER_VARIABLE</key>
      <value>556</value>
     </element>
    </variables>
   </environment>
   <resources>
    <element>event-queue</element>
   </resources>
  </element>
 </servers>
 <executables>
  <element>
   <path>mq-server</path>
   <arguments>
    <element>--configuration</element>
    <element>/path/to/configuration</element>
   </arguments>
   <memberships>
    <element>common-group</element>
   </memberships>
  </element>
 </executables>
 <services>
  <element>
   <name>postSalesSaveService</name>
   <timeout>2h</timeout>
   <routes>
    <element>postSalesSaveService</element>
    <element>sales/post/save</element>
   </routes>
  </element>
  <element>
   <name>postSalesGetService</name>
   <timeout>130ms</timeout>
  </element>
 </services>
 <gateway>
  <default>
   <listener>
    <limit />
   </listener>
   <connection>
    <restart>true</restart>
    <address></address>
   </connection>
  </default>
  <listeners>
   <element>
    <address>localhost:7779</address>
    <limit>
     <size>2097152</size>
    </limit>
    <note>local host - if threshold of 2MB of total payload 'in flight' is reach inbound will stop consume from socket until we're below</note>
   </element>
   <element>
    <address>some.host.org:7779</address>
    <limit>
     <messages>200</messages>
    </limit>
    <note>listener that is bound to some 'external ip' - limit to max 200 calls 'in flight'</note>
   </element>
   <element>
    <address>some.host.org:9999</address>
    <limit>
     <size>10485760</size>
     <messages>10</messages>
    </limit>
    <note>listener - threshold of either 10 messages OR 10MB - the first that is reach, inbound will stop consume</note>
   </element>
   <element>
    <address>some.host.org:4242</address>
    <note>listener - no limits</note>
   </element>
  </listeners>
  <connections>
   <element>
    <address>a45.domain.host.org:7779</address>
    <services>
     <element>s1</element>
     <element>s2</element>
    </services>
    <queues />
    <note>connection to domain 'a45' - we expect to find service 's1' and 's2' there.</note>
   </element>
   <element>
    <address>a46.domain.host.org:7779</address>
    <services>
     <element>s1</element>
    </services>
    <queues>
     <element>q1</element>
     <element>q2</element>
    </queues>
    <note>connection to domain 'a46' - we expect to find queues 'q1' and 'q2' and service 's1' - casual will only route 's1' to a46 if it's not accessible in a45 (or local)</note>
   </element>
   <element>
    <address>a99.domain.host.org:7780</address>
    <services />
    <queues />
    <restart>false</restart>
    <note>connection to domain 'a99' - if the connection is closed from a99, casual will not try to reestablish the connection</note>
   </element>
  </connections>
 </gateway>
 <queue>
  <default>
   <queue>
    <retry>
     <count>3</count>
     <delay>20s</delay>
    </retry>
   </queue>
   <directory>${CASUAL_DOMAIN_HOME}/queue/groups</directory>
  </default>
  <groups>
   <element>
    <name>groupA</name>
    <note>will get default queuebase: ${CASUAL_DOMAIN_HOME}/queue/groupA.gb</note>
    <queues>
     <element>
      <name>q_A1</name>
     </element>
     <element>
      <name>q_A2</name>
      <retry>
       <count>10</count>
       <delay>100ms</delay>
      </retry>
      <note>after 10 rollbacked dequeues, message is moved to q_A2.error</note>
     </element>
     <element>
      <name>q_A3</name>
     </element>
     <element>
      <name>q_A4</name>
     </element>
    </queues>
   </element>
   <element>
    <name>groupB</name>
    <queuebase>/some/fast/disk/queue/groupB.qb</queuebase>
    <queues>
     <element>
      <name>q_B1</name>
     </element>
     <element>
      <name>q_B2</name>
      <retry>
       <count>20</count>
      </retry>
      <note>after 20 rollbacked dequeues, message is moved to q_B2.error. retry.delay is 'inherited' from default, if any</note>
     </element>
    </queues>
   </element>
   <element>
    <name>groupC</name>
    <queuebase>:memory:</queuebase>
    <note>group is an in-memory queue, hence no persistence</note>
    <queues>
     <element>
      <name>q_C1</name>
     </element>
     <element>
      <name>q_C2</name>
     </element>
    </queues>
   </element>
  </groups>
  <note>retry.count - if number of rollbacks is greater, message is moved to error-queue : retry.delay - the amount of time before the message is available for consumption, after rollback</note>
 </queue>
</domain>
